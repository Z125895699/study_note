<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      let arr = [
        { id: 1, name: '部门1', pid: 0 },
        { id: 2, name: '部门2', pid: 1 },
        { id: 3, name: '部门3', pid: 1 },
        { id: 4, name: '部门4', pid: 3 },
        { id: 5, name: '部门5', pid: 4 },
      ];
      let arr1 = [
        {
          id: 334,
          name: '牛奶部',
          parentId: 1,
          createAt: '2021-10-24T09:53:46.000Z',
          updateAt: '2021-10-24T09:53:46.000Z',
        },
        {
          id: 333,
          name: '智能制造部',
          parentId: 1,
          createAt: '2021-10-24T09:52:17.000Z',
          updateAt: '2021-10-24T09:52:17.000Z',
        },
        {
          id: 332,
          name: '生产部',
          parentId: 1,
          createAt: '2021-10-24T09:50:17.000Z',
          updateAt: '2021-10-24T09:50:17.000Z',
        },
        {
          id: 331,
          name: '11',
          parentId: 4,
          createAt: '2021-10-24T02:55:17.000Z',
          updateAt: '2021-10-24T02:55:17.000Z',
        },
        {
          id: 5,
          name: '人事部',
          parentId: 1,
          createAt: '2021-01-02T10:04:02.000Z',
          updateAt: '2021-05-02T07:33:08.000Z',
        },
        {
          id: 4,
          name: '客服部',
          parentId: 2,
          createAt: '2021-01-02T10:04:02.000Z',
          updateAt: '2021-08-03T11:14:32.000Z',
        },
        {
          id: 3,
          name: '运营部',
          parentId: 1,
          createAt: '2021-01-02T10:03:42.000Z',
          updateAt: '2021-01-05T08:25:52.000Z',
        },
        {
          id: 2,
          name: '研发部',
          parentId: 1,
          createAt: '2021-01-02T10:03:21.000Z',
          updateAt: '2021-01-05T08:25:49.000Z',
        },
        {
          id: 1,
          name: '总裁办',
          parentId: null,
          createAt: '2021-01-02T10:03:09.000Z',
          updateAt: '2021-01-05T08:25:46.000Z',
        },
      ];

      // 第三种 递归
      function tree(pid, arr) {
        return arr
          .filter((item) => item.pid === pid)
          .map((item) => ({ ...item, children: tree(item.id, arr) }));
      }
      console.table(tree(0, arr));

      //第一种
      // function arrayToTree(items) {
      //   const result = []; // 存放结果集
      //   const itemMap = {}; //
      //   // 先转成map存储
      //   for (const item of items) {
      //     itemMap[item.id] = { ...item, children: [] };
      //   }

      //   for (const item of items) {
      //     const id = item.id;
      //     const parentId = item.parentId;
      //     const treeItem = itemMap[id];
      //     if (parentId === null) {
      //       result.push(treeItem);
      //     } else {
      //       if (!itemMap[parentId]) {
      //         itemMap[parentId] = {
      //           children: [],
      //         };
      //       }
      //       itemMap[parentId].children.push(treeItem);
      //     }
      //   }
      //   return result;
      // }

      // //第二种
      // function toTree(items) {
      //   const map = new Map();
      //   for (const item of items) {
      //     let children = map.get(item.id) || [];

      //     if (map.has(item.pid)) {
      //       let arr = map.get(item.pid);
      //       arr.push({ ...item, children });
      //     } else {
      //       let arr = [];
      //       arr.push({ ...item, children });
      //       map.set(item.pid, arr);
      //     }
      //     if (!map.has(item.id)) {
      //       map.set(item.id, children);
      //     }
      //   }
      //   return map.get(0);
      // }
      // console.table(arr);
      // console.table(toTree(arr));
      // console.table(arrayToTree(arr1));

      function tree(parentId, arr1) {
        return arr1
          .filter((item) => item.parentId === parentId)
          .map((item) => ({ ...item, children: tree(item.id, arr1) }));
      }
      console.table(tree(null, arr1));
    </script>
  </body>
</html>
